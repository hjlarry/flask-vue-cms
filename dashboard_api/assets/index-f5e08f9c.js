import{c8 as q,bW as F,cd as J,bX as K}from"./index-27b2444c.js";import{u as O,b as P,c as Q,d as Y}from"./user-6d708853.js";import{u as N,w as Z}from"./xlsx-17b2b417.js";import{r as c,a3 as s,j as g,v as y,x as l,l as S,D as a,B as d,C as p,w as X,k as B,F as L,X as j,bs as ee,ad as le,y as I}from"./_plugin-vue_export-helper-a4851b7b.js";import{g as ae}from"./role-fd6cbb35.js";const te={class:"dialog-footer"},oe={__name:"Export2Excel",props:{dialogVisable:{type:Boolean,required:!0},tableData:{type:Array,required:!0}},emits:["update:dialogVisable"],setup(h,{emit:v}){const m=h,f=q(),u=c("");u.value=f.t("msg.excel.defaultName");function i(){v("update:dialogVisable",!1)}const r=c(!1);function V(){r.value=!0;const t=N.json_to_sheet(m.tableData),n=N.book_new();N.book_append_sheet(n,t,"Data"),Z(n,u.value+".xlsx"),r.value=!1,i()}return(t,n)=>{const _=s("el-input"),k=s("el-button"),C=s("el-dialog");return g(),y(C,{title:t.$t("msg.excel.title"),width:"30%","model-value":h.dialogVisable,onClose:i},{footer:l(()=>[S("span",te,[a(k,{onClick:i},{default:l(()=>[d(p(t.$t("msg.excel.close")),1)]),_:1}),a(k,{type:"primary",onClick:V,loading:r.value},{default:l(()=>[d(p(t.$t("msg.excel.confirm")),1)]),_:1},8,["loading"])])]),default:l(()=>[a(_,{modelValue:u.value,"onUpdate:modelValue":n[0]||(n[0]=x=>u.value=x),placeholder:t.$t("msg.excel.placeholder"),clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["title","model-value"])}}},ne={__name:"showRole",props:{modelValue:{required:!0,type:Boolean},userId:{type:Number,required:!0}},emits:["update:modelValue","updateRole"],setup(h,{emit:v}){const m=h;function f(){v("update:modelValue",!1),r.value=[]}async function u(){const t=r.value.map(n=>i.value.find(_=>_.title===n));await O(m.userId,t),F.success("更新成功"),f(),v("updateRole")}const i=c([]),r=c([]);async function V(){i.value=(await ae()).data;const t=(await P(m.userId)).data;r.value=t.map(n=>n.title)}return X(()=>m.userId,t=>{t&&V()}),(t,n)=>{const _=s("el-checkbox"),k=s("el-checkbox-group"),C=s("el-button"),x=s("el-dialog");return g(),y(x,{"model-value":h.modelValue,onClose:f,title:t.$t("msg.excel.roleDialogTitle")},{footer:l(()=>[S("span",null,[a(C,{onClick:f},{default:l(()=>[d(p(t.$t("msg.universal.cancel")),1)]),_:1}),a(C,{onClick:u,type:"primary"},{default:l(()=>[d(p(t.$t("msg.universal.confirm")),1)]),_:1})])]),default:l(()=>[a(k,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=$=>r.value=$)},{default:l(()=>[(g(!0),B(L,null,j(i.value,$=>(g(),y(_,{key:$.id,label:$.title},null,8,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["model-value","title"])}}};const se={class:"excel-btn"},ie={__name:"index",setup(h){const v=c([]),m=c(1),f=c(0),u=c(20);async function i(){const e=await Q({page:m.value,per_page:u.value});v.value=e.data.users,f.value=e.data.pagination.total}i();function r(e){u.value=e,i()}function V(e){m.value=e,i()}const t=J();function n(){t.push("/user/import")}const _=q();function k(e){K.confirm(_.t("msg.excel.dialogTitle1")+e.username+_.t("msg.excel.dialogTitle2"),{type:"warning"}).then(async()=>{await Y(e.id),F.success(_.t("msg.excel.removeSuccess")),await i()}).catch(()=>{})}function C(e){t.push({name:"userInfo",params:{id:e.id}})}const x=c(!1);function $(){x.value=!0}const z=c(!1),D=c(NaN);function M(e){z.value=!0,D.value=e.id}return X(z,e=>{e||(D.value=NaN)}),(e,b)=>{const R=s("el-button"),T=s("el-card"),w=s("el-table-column"),A=s("el-avatar"),W=s("el-tag"),G=s("el-table"),H=s("el-pagination"),E=le("permission");return g(),B("div",null,[a(T,{shadow:"hover",class:"head-container"},{default:l(()=>[S("div",se,[I((g(),y(R,{type:"primary",onClick:n},{default:l(()=>[d(p(e.$t("msg.excel.importExcel")),1)]),_:1})),[[E,["importUser"]]]),a(R,{type:"success",onClick:$},{default:l(()=>[d(p(e.$t("msg.excel.exportExcel")),1)]),_:1})])]),_:1}),a(T,{class:"table-container",shadow:"never"},{default:l(()=>[a(G,{data:v.value,border:""},{default:l(()=>[a(w,{label:"#",type:"index",width:"50",align:"center"}),a(w,{label:e.$t("msg.excel.name"),prop:"username"},null,8,["label"]),a(w,{label:e.$t("msg.excel.avatar"),align:"center"},{default:l(({row:o})=>[a(A,{src:o.avatar,size:"default"},null,8,["src"])]),_:1},8,["label"]),a(w,{label:e.$t("msg.excel.role"),prop:"roles",align:"center"},{default:l(({row:o})=>[(g(!0),B(L,null,j(o.roles,U=>(g(),y(W,{key:U.id,size:"small"},{default:l(()=>[d(p(U.title),1)]),_:2},1024))),128))]),_:1},8,["label"]),a(w,{label:e.$t("msg.excel.openTime"),prop:"openTime",align:"center"},{default:l(({row:o})=>[d(p(e.$filters.dateFilter(o.openTime)),1)]),_:1},8,["label"]),a(w,{label:e.$t("msg.excel.action"),align:"center"},{default:l(({row:o})=>[a(R,{type:"primary",size:"small",onClick:U=>C(o)},{default:l(()=>[d(p(e.$t("msg.excel.show")),1)]),_:2},1032,["onClick"]),I((g(),y(R,{type:"info",size:"small",onClick:U=>M(o)},{default:l(()=>[d(p(e.$t("msg.excel.showRole")),1)]),_:2},1032,["onClick"])),[[E,["distributeRole"]]]),I((g(),y(R,{type:"danger",size:"small",onClick:U=>k(o)},{default:l(()=>[d(p(e.$t("msg.excel.remove")),1)]),_:2},1032,["onClick"])),[[E,["removeUser"]]])]),_:1},8,["label"])]),_:1},8,["data"])]),_:1}),a(H,{class:"pagination","current-page":m.value,"onUpdate:current-page":b[0]||(b[0]=o=>m.value=o),"page-size":u.value,"onUpdate:page-size":b[1]||(b[1]=o=>u.value=o),"page-sizes":[2,10,30],layout:"sizes, prev, pager, next, total",total:f.value,onSizeChange:r,onCurrentChange:V},null,8,["current-page","page-size","total"]),a(oe,{"dialog-visable":x.value,"onUpdate:dialog-visable":b[2]||(b[2]=o=>x.value=o),"table-data":v.value},null,8,["dialog-visable","table-data"]),a(ne,{modelValue:z.value,"onUpdate:modelValue":b[3]||(b[3]=o=>z.value=o),"user-id":D.value,onUpdateRole:i},null,8,["modelValue","user-id"])])}}},me=ee(ie,[["__scopeId","data-v-8239e441"]]);export{me as default};
